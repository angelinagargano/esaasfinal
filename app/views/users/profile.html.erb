<!-- app/views/users/profile.html.erb -->

<h1 class="mb-4">My Profile</h1>

<div class="user-info mb-4">
  <h2>Welcome, <%= @user.name %>!</h2>
  <p class="text-white"><strong>Username:</strong> <%= @user.username %></p>
  <p class="text-white"><strong>Email:</strong> <%= @user.email %></p>
  
  <%= link_to "Edit my information", edit_user_path(@user), class: "btn btn-primary mt-3" %>
</div>

<hr style="border-color: rgba(255, 255, 255, 0.2);">

<div class="events-section mt-4">
  <h2 class="mb-3">Liked Events</h2>
  <hr style="border-color: rgba(255, 255, 255, 0.2);">

  <div class="friends-section mt-4">
    <h2 class="mb-3">My Friends</h2>
    <%# Use controller-provided collections so accepted friends include incoming + outgoing %>
    <% if (@friends || []).any? || (@outgoing_pending || []).any? %>
      <div class="friends-list">
        <% (@friends || []).each do |friend| %>
          <div class="card mb-2 border shadow-sm">
            <div class="card-body d-flex justify-content-between align-items-center">
              <div>
                <h5 class="card-title mb-0"><%= friend.username %></h5>
                <p class="card-text text-muted mb-0"><%= friend.email %></p>
              </div>
              <div>
                <%= link_to "Unfriend", unfriend_path(friend), method: :delete, class: "btn btn-sm btn-danger" %>
              </div>
            </div>
          </div>
        <% end %>

        <%# Show outgoing pending requests with disabled button %>
        <% (@outgoing_pending || []).each do |friend| %>
          <div class="card mb-2 border shadow-sm">
            <div class="card-body d-flex justify-content-between align-items-center">
              <div>
                <h5 class="card-title mb-0"><%= friend.username %></h5>
                <p class="card-text text-muted mb-0"><%= friend.email %></p>
              </div>
              <div>
                <button class="btn btn-sm btn-secondary" disabled>Friend request sent</button>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-white">You don't have any friends yet.</p>
    <% end %>
  </div>

  <hr style="border-color: rgba(255, 255, 255, 0.2);">

  <div class="friend-requests-section mt-4">
    <h2 class="mb-3">Friend Requests Received</h2>
    <% if (@incoming_pending || []).any? %>
      <div class="friend-requests-list">
        <% (@incoming_pending || []).each do |user_requesting| %>
          <div class="card mb-2 border shadow-sm">
            <div class="card-body d-flex justify-content-between align-items-center">
              <div>
                <h5 class="card-title mb-0"><%= user_requesting.username %></h5>
                <p class="card-text text-muted mb-0"><%= user_requesting.email %></p>
              </div>
              <div>
                <%= link_to "Accept", accept_friend_path(user_requesting), method: :post, class: "btn btn-sm btn-success" %>
                <%= link_to "Reject", reject_friend_path(user_requesting), method: :delete, class: "btn btn-sm btn-danger" %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-white">You don't have any pending friend requests.</p>
    <% end %>
  </div>

  <hr style="border-color: rgba(255, 255, 255, 0.2);">

  <div class="events-section mt-4">
    <h2 class="mb-3">Liked Events</h2>
  <% if @liked_events.any? %>
    <div class="liked-events row">
      <% @liked_events.each do |event| %>
        <div class="col-md-6 mb-3">
          <div class="event-card card border shadow-sm">
            <div class="card-body">
              <h3 class="card-title"><%= event.name %></h3>
              <p class="card-text"><strong>Date:</strong> <%= event.date %></p>
              <p class="card-text"><strong>Time:</strong> <%= event.time %></p>
              <p class="card-text"><strong>Venue:</strong> <%= event.venue %></p>
              <p class="card-text"><strong>Location:</strong> <%= event.location %></p>
              <%= link_to "View Details", details_performance_path(event), class: "btn btn-primary" %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="text-white">You haven't liked any events yet</p>
  <% end %>
</div>

<hr class="my-4">

<div class="events-section mt-4">
  <h2 class="mb-3">Events I'm Going To</h2>
  <% if @going_events.any? %>
    <div class="going-events row">
      <% @going_events.each do |event| %>
        <div class="col-md-6 mb-3">
          <div class="event-card card border shadow-sm">
            <div class="card-body">
              <h3 class="card-title"><%= event.name %></h3>
              <p class="card-text"><strong>Date:</strong> <%= event.date %></p>
              <p class="card-text"><strong>Time:</strong> <%= event.time %></p>
              <p class="card-text"><strong>Venue:</strong> <%= event.venue %></p>
              <p class="card-text"><strong>Location:</strong> <%= event.location %></p>
              <%= link_to "View Details", details_performance_path(event), class: "btn btn-primary" %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="text-white">You're not attending any events yet.</p>
  <% end %>
</div>